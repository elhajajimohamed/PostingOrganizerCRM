# Call Center Database Structure

## Complete Schema for Call Center Records

### Required Fields (Core)
```json
{
  "id": "string (auto-generated)",
  "name": "string (company/business name)",
  "country": "Morocco | Tunisia | Senegal | Ivory Coast | Guinea | Cameroon",
  "city": "string (city name)",
  "positions": "number (employee count)",
  "status": "New | Contacted | Qualified | Proposal | Negotiation | Closed-Won | Closed-Lost | On-Hold",
  "phones": ["string (array of phone numbers)"],
  "emails": ["string (array of email addresses)"],
  "website": "string (company website URL)",
  "createdAt": "string (ISO 8601 timestamp)",
  "updatedAt": "string (ISO 8601 timestamp)"
}
```

### Optional Fields (Extended)
```json
{
  "businessType": "call-center | voip-reseller | data-vendor | workspace-rental | individual",
  "phone_infos": [{"PhoneInfo objects"}],
  "tags": ["string (array of tags)"],
  "notes": "string (free-text notes)",
  "lastContacted": "string (ISO 8601 timestamp) | null",
  "value": "number (deal value, default 0)",
  "currency": "string (currency code, default 'USD')",
  "address": "string (full address)",
  "source": "string (lead source)",
  "type": "string (business type)",
  "markets": ["string (target markets)"],
  "competitors": ["string (competitor names)"],
  "socialMedia": ["string (social media URLs)"],
  "foundDate": "string (ISO 8601 timestamp)",
  "is_client": "boolean (default false)",
  "is_blacklisted": "boolean (default false)",
  "is_valid_phone": "boolean",
  "attempts_last_90_days": "number (call attempts in last 90 days)",
  "attempts_last_15_days": "number (call attempts in last 15 days)",
  "attempts_30d": "number (call attempts in last 30 days)",
  "lead_quality_score": "number (0-100 quality score)",
  "company_size_score": "number (0-100 size score)",
  "business_hours_score": "number (0-100 timing score)",
  "last_contacted_via_whatsapp": "string (ISO 8601 timestamp)"
}
```

### Phone Info Structure (Generated Automatically)
```json
{
  "original": "string (original phone number)",
  "phone_norm": "string (normalized phone number)",
  "country_code": "string (country code)",
  "nsn": "string (national significant number)",
  "is_mobile": "boolean (is mobile phone)",
  "whatsapp_confidence": "number (0-1 confidence score)",
  "mobile_detection_reason": "string (reason for mobile detection)"
}
```

### Example Call Center Record
```json
{
  "id": "DyuBszBFN3k9V9fuEljM",
  "name": "AVICENTER Yaoundé (Ex CROOS)",
  "country": "Cameroon",
  "city": "Yaoundé",
  "positions": 13,
  "status": "New",
  "value": 0,
  "currency": "USD",
  "phones": ["6 54 28 52 85"],
  "phone_infos": [],
  "emails": [],
  "website": "http://www.avicenter.fr/",
  "address": "VG79+8VC face pharmacie Française, 140 Avenue du Président Ahmadou Ahidjo, Yaoundé, Cameroon",
  "source": "google",
  "type": "",
  "tags": ["google-lead", "potential-call-center"],
  "markets": [],
  "competitors": [],
  "socialMedia": [],
  "foundDate": "2025-10-25T16:29:18.228Z",
  "lastContacted": null,
  "notes": "Lead found via Google Places search. Rating: 4.7/5 (102 reviews). Maps URL: undefined",
  "createdAt": "2025-10-25T16:29:18.228Z",
  "updatedAt": "2025-10-25T16:29:18.228Z"
}
```

## Field Descriptions

### Core Required Fields
- **id**: Auto-generated by Firebase Firestore
- **name**: Company/business name
- **country**: Must be one of: Morocco, Tunisia, Senegal, Ivory Coast, Guinea, Cameroon
- **city**: City where the business is located
- **positions**: Number of employees/positions in the company
- **status**: Sales pipeline status (defaults to "New")
- **phones**: Array of phone numbers (can be multiple)
- **emails**: Array of email addresses (can be multiple)
- **website**: Company website URL
- **createdAt**: ISO timestamp when record was created
- **updatedAt**: ISO timestamp when record was last updated

### Automatic Processing
The system automatically:
1. **Phone Detection**: Analyzes phone numbers and creates `phone_infos` objects
2. **WhatsApp Detection**: Determines which phones support WhatsApp
3. **Score Calculation**: Computes various scores for call prioritization

### Valid Country Values
- Morocco
- Tunisia
- Senegal
- Ivory Coast
- Guinea
- Cameroon

### Valid Status Values
- New
- Contacted
- Qualified
- Proposal
- Negotiation
- Closed-Won
- Closed-Lost
- On-Hold

### Valid Business Type Values
- **call-center** - Traditional call center operations
- **voip-reseller** - VoIP services provider
- **data-vendor** - Data services provider
- **workspace-rental** - Office/workspace rental business
- **individual** - Individual entrepreneur/freelancer

## Creation Guidelines

### Minimal Required Structure
To create a new call center, you need at minimum:
```javascript
{
  name: "Company Name",
  country: "Morocco", // or other valid country
  city: "City Name",
  positions: 10, // or any number
  status: "New", // or other status
  phones: ["+1234567890"], // at least one phone
  emails: [], // can be empty array
  website: "", // can be empty string
  notes: "", // can be empty string
  tags: [] // can be empty array
}
```

### Best Practices
1. **Always provide at least one phone number**
2. **Use proper country codes in phone numbers**
3. **Include meaningful tags for categorization**
4. **Fill in as much contact information as possible**
5. **Use consistent naming conventions**
6. **Add detailed notes for better lead tracking**

## API Usage

To create a call center programmatically:
```javascript
// Using the ExternalCRMService
const callCenterData = {
  name: "New Call Center",
  country: "Morocco",
  city: "Casablanca",
  positions: 25,
  status: "New",
  phones: ["+212-5-123-4567"],
  emails: ["info@callcenter.ma"],
  website: "https://callcenter.ma",
  notes: "Potential lead from web search",
  tags: ["web-lead", "high-potential"]
};

await ExternalCRMService.createCallCenter(callCenterData);
```

## Important Notes

1. **ID Generation**: The system auto-generates document IDs in Firestore
2. **Phone Processing**: Phone detection runs automatically during creation
3. **Timestamps**: createdAt and updatedAt are set automatically
4. **Validation**: Country and status values are validated
5. **Subcollections**: Contacts, steps, callHistory, and recharges are stored as subcollections
6. **Scoring**: Various scoring algorithms run automatically for call prioritization